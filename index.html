<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Excel Downloader</title>
        <!-- Bootstrap CSS CDN -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
            crossorigin="anonymous"
        />
        <!-- Custom CSS -->
        <link rel="stylesheet" href="style.css" />
    </head>
    <body class="bg-light">
        <div
            class="container d-flex justify-content-center align-items-center min-vh-100"
        >
            <div
                class="card shadow-lg p-4 p-md-5"
                style="max-width: 600px; width: 100%"
            >
                <h1 class="card-title text-center mb-4">Excel Downloader</h1>
                <p class="text-center text-muted mb-4">
                    Mendownload file Excel dari endpoint API
                </p>

                <form id="downloadForm">
                    <div class="mb-3">
                        <label for="apiUrl" class="form-label"
                            >API Endpoint URL:</label
                        >
                        <input
                            type="url"
                            class="form-control"
                            id="apiUrl"
                            value="http://localhost:3000/v1/transactions/export"
                            required
                        />
                        <div class="form-text">
                            Contoh:
                            <code
                                >http://localhost:3000/v1/transactions/export</code
                            >
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="httpMethod" class="form-label"
                            >HTTP Method:</label
                        >
                        <select class="form-select" id="httpMethod">
                            <option value="GET" selected>GET</option>
                            <option value="POST" selected>POST</option>
                            <!-- For this specific request, only POST is needed, but could be extended -->
                        </select>
                    </div>
                    <button
                        type="submit"
                        class="btn btn-primary w-100 mt-3"
                        id="downloadButton"
                    >
                        DOWNLOAD
                    </button>
                </form>

                <!-- Progress Bar Section -->
                <div
                    id="progressBarContainer"
                    class="mt-4"
                    style="display: none"
                >
                    <div class="progress">
                        <div
                            id="downloadProgressBar"
                            class="progress-bar progress-bar-striped progress-bar-animated"
                            role="progressbar"
                            style="width: 0%"
                            aria-valuenow="0"
                            aria-valuemin="0"
                            aria-valuemax="100"
                        >
                            0%
                        </div>
                    </div>
                    <p id="progressText" class="text-center mt-2 text-muted">
                        Mempersiapkan download...
                    </p>
                </div>
            </div>
        </div>

        <!-- Login Modal -->
        <div
            class="modal fade"
            id="loginModal"
            tabindex="-1"
            aria-labelledby="loginModalLabel"
            aria-hidden="true"
            data-bs-backdrop="static"
            data-bs-keyboard="false"
        >
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="loginModalLabel">
                            Autentikasi Diperlukan
                        </h5>
                    </div>
                    <div class="modal-body">
                        <p class="text-muted">
                            Sesi Anda telah berakhir atau Anda belum login.
                            Silakan login untuk melanjutkan.
                        </p>
                        <form id="loginForm">
                            <div class="mb-3">
                                <label for="email" class="form-label"
                                    >Email:</label
                                >
                                <input
                                    type="email"
                                    class="form-control"
                                    id="email"
                                    required
                                />
                            </div>
                            <div class="mb-3">
                                <label for="password" class="form-label"
                                    >Password:</label
                                >
                                <input
                                    type="password"
                                    class="form-control"
                                    id="password"
                                    required
                                />
                            </div>
                            <div
                                id="loginError"
                                class="alert alert-danger"
                                style="display: none"
                            ></div>
                            <button type="submit" class="btn btn-primary w-100">
                                Login
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Success Modal -->
        <div
            class="modal fade"
            id="successModal"
            tabindex="-1"
            aria-labelledby="successModalLabel"
            aria-hidden="true"
        >
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header bg-success text-white">
                        <h5 class="modal-title" id="successModalLabel">
                            Download Berhasil!
                        </h5>
                        <button
                            type="button"
                            class="btn-close btn-close-white"
                            data-bs-dismiss="modal"
                            aria-label="Close"
                        ></button>
                    </div>
                    <div class="modal-body text-center">
                        <p class="lead">File Excel berhasil diunduh.</p>
                        <p class="text-muted small">
                            Jika download tetap tidak muncul, silakan
                            <a href="#" id="retryDownloadLink"
                                >hit ulang link ini</a
                            >.
                        </p>
                    </div>
                    <div class="modal-footer justify-content-center">
                        <button
                            type="button"
                            class="btn btn-secondary"
                            data-bs-dismiss="modal"
                        >
                            Tutup
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Error Modal -->
        <div
            class="modal fade"
            id="errorModal"
            tabindex="-1"
            aria-labelledby="errorModalLabel"
            aria-hidden="true"
        >
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header bg-danger text-white">
                        <h5 class="modal-title" id="errorModalLabel">
                            Download Gagal!
                        </h5>
                        <button
                            type="button"
                            class="btn-close btn-close-white"
                            data-bs-dismiss="modal"
                            aria-label="Close"
                        ></button>
                    </div>
                    <div class="modal-body text-center">
                        <p id="errorMessage" class="lead text-danger"></p>
                        <p class="text-muted small">
                            Mohon periksa URL atau coba lagi nanti.
                        </p>
                    </div>
                    <div class="modal-footer justify-content-center">
                        <button
                            type="button"
                            class="btn btn-secondary"
                            data-bs-dismiss="modal"
                        >
                            Tutup
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bootstrap JS CDN -->
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
            crossorigin="anonymous"
        ></script>
        <!-- Custom JavaScript -->
        <script src="script.js"></script>
    </body>
</html>
